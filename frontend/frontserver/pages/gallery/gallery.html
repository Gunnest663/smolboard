<div class="gallery">
	{{ template "nav" . }}

	<div class="content">
		<aside>
			<div class="gallery-info">
				<legend>Gallery Information</legend>

				<div class="gallery-table table">
					<span>Total</span>
					<span id="total">{{ humanizeNumber .Total }}</span>

					<span>Size</span>
					<span id="size">{{ humanizeSize .Sizes }}</span>
				</div>
			</div>

			{{ if (gt .Total 25) }}
			<form class="paginator" action="/posts">
				<legend>Gallery Page</legend>

				<input type="hidden" name="q" value={{ .Query }}>

				{{ $lastPage := (numPages .Total) }}
				{{ $prevPage := (dec .Page) }}
				{{ $nextPage := (inc .Page) }}

				<div class="page-buttons">
					<button type="submit" class="last-page small" name="p"
						{{ if (gt $prevPage 0) }}
						value="{{ $prevPage }}"
						{{ else }}
						disabled
						{{ end }}
					>
						❮ Prev
					</button>

					<input type="submit" style="display: none">
					<input type="number" class="page-input small"
						   min="1" max="{{ $lastPage }}" value="{{ .Page }}"
					>
					<span class="max-page"> / {{ $lastPage }}</span>

					<button type="submit" class="next-page small" name="p"
						{{ if (le $nextPage $lastPage) }}
						value="{{ $nextPage }}"
						{{ else }}
						disabled
						{{ end }}
					>
						Next ❯
					</button>
				</div>
			</form>
			{{ end }}

			{{ with .User }}
			<div class="search-user-info">
				<legend>User Information</legend>

				<div class="user-table table">
					<span>Joined</span>
					<time datetime="{{ htmlTime .Joined }}" id="join-time">
						{{ humanizeTime .Joined }}
					</time>

					<span>Permission</span>
					<span id="permission">{{ .Permission }}</span>
				</div>
			</div>
			{{ end }}

			{{ with .AllowedUploadPerms }}
			<form class="uploader"
				  action="/posts" method="post"
				  enctype="multipart/form-data"
			>
				<legend>Upload Files</legend>

				<input  type="file"     name="file" multiple>
				<select id="permission" name="p">
					{{ range . }}
					<option value="{{ .StringInt }}">{{ . }}</option>
					{{ end }}
				</select>

				<input type="submit" value="Upload" class="small">
			</form>
			{{ end }}

			{{ if .IsAdmin }}
			<div class="tokens">
				<legend>Invite Tokens</legend>

				<div class="token-list">
					{{ template "tokenList" .Tokens }}
				</div>

				<form class="add-token seamless" action="/tokens" method="post">
					{{ $min := .MinTokenUses }}

					<p class="info">
						<span>Create Token</span>
						<span class="range">{{ $min }} to {{ .MaxUses }}</span>
					</p>

					<div class="form-group">
						<input type="number" class="small" name="uses"
							   value="1" min="{{ $min }}" max="{{ .MaxUses }}">
						<input type="submit" class="small" value="＋">
					</div>
				</form>
			</div>
			{{ end }}

			{{ if .Username }}
			<form class="logout" action="/signout" method="post">
				<button type="submit" class="small">Sign out</button>
			</form>
			{{ end }}
		</aside>

		<main class="posts row">
			{{ range .Posts }}
			<figure class="gallery-post card">
				<a href="/posts/{{.ID}}">
					{{ if (isImage .ContentType) }}
					<img loading="lazy" {{ $.SizeAttr . }}
						 src="{{ $.Session.PostThumbURL . }}"
						 style="background-image: url('{{ $.InlineImage . }}')">
	
					{{ else if (isVideo .ContentType) }}
					<video alt="Video" preload="metadata" {{ $.SizeAttr . }}
						   src="{{ $.Session.PostThumbURL . }}#t=0.1"
						   style="background-image: url('{{ $.InlineImage . }}')">
	
					{{ else }}
					<div>
						<p><span class=".icon-link"></span></p>
						<p>{{ .ContentType }}</p>
					</div>
	
					{{ end }}
				</a>
			</figure>
			{{ end }}
		</main>
	</div>
</div>

{{ template "footer" }}

{{ define "tokenList" }}

{{ range $index, $token := . }}
	<div class="token">
		<label for="token_{{$index}}">
			<span id="creator">{{ $token.Creator }}</span>
			<span id="remaining">{{ negInf $token.Remaining }}</span>
		</label>

		<input type="checkbox" id="token_{{$index}}" class="modal">
		<div role="dialog">
			<div class="card">
				<label for="token_{{$index}}" class="modal-close"></label>

				<h3 class="section">
					<small>Invite Token</small>
					{{ $token.Token }}
				</h3>

				<form class="section token-actions seamless">
					<legend>Actions</legend>

					<button type="submit" class="delete-token secondary"
							formmethod="post"
							formaction="/tokens/{{$token.Token}}/delete"
					>
						<span class="icon-alert secondary inverse"></span>
						<span>Delete Token</span>
					</button>
				</form>
			</div>
		</div>
	</div>
{{ else }}
	<p class="no-token-msg">No tokens.</p>
{{ end }}

{{ end }}
